let data,tabButtons=document.querySelectorAll("footer button"),tabElements=document.querySelectorAll("#tab"),currentTab=0,mainPagesGenerates=1,mainPageLength=10,settings_dailygoal_input=document.querySelector("#settings-dailygoal-input"),settings_json=document.querySelector("#settings-json"),version=1;localStorage.getItem("version")||localStorage.setItem("version",version),version>Number(localStorage.getItem("version"))&&(console.warn("Переход на новую версию ("+version+")"),localStorage.setItem("version",version));let lsFavourite,favTab=document.querySelector('#tab[data-index="2"]'),lsDaily=[0,100];function favouriteLS(){localStorage.getItem("favourite")||localStorage.setItem("favourite","-1"),lsFavourite=localStorage.getItem("favourite").split(","),lsFavourite=[...new Set(lsFavourite)],console.log(`Favourite: [${lsFavourite}]`)}function generateFavouriteTab(){if(lsFavourite.length,lsFavourite.length>1)for(let e of lsFavourite)"-1"!=e&&(favTab.innerHTML+=generateBox(data[e],"fav"))}let trainingLoaded=!1;function changeTab(e){1!=e||trainingLoaded||loadTrainingTasks();for(let t of tabButtons){t.classList.remove("current"),t.dataset.index==e&&t.classList.add("current");for(let t of tabElements)t.style.display="none",t.dataset.index==e&&(t.style.display=""),t.dataset.index==currentTab&&window.scrollTo(0,0)}}changeTab(currentTab);for(let e of tabButtons)e.addEventListener("click",()=>{changeTab(e.dataset.index)});let trainingTasks,trainMain,trainTask,trainButtons,trainExplain,trainExplainBox,currentTask,mainTab=document.querySelector('#tab[data-index="0"]'),trainingTab=document.querySelector('#tab[data-index="1"]');function generateBox(e,t,a){let n='<div class="paronym-box grid" data-index="'+data.indexOf(e)+'">';for(let t of e){e.indexOf(t)<e.length-1?n+='<div class="border"><p><b>'+t.title+"</b></p>":n+="<div><p><b>"+t.title+"</b></p>";let a="";for(let e of t.def)if(a+="<details><summary>"+e[0]+"</summary>","string"==typeof e[1])a+='<p class="paronym-box-example">'+e[1]+"</p></details>";else{let t='<ul class="paronym-box-example">';for(let a of e[1])t+="<li>"+a+"</li>";a+=t+="</ul></details>"}n+=a+"</div>"}return n+='<div class="paronym-box-actions">',"main"==t&&(n+='<button onclick="favourite('+data.indexOf(e)+')">Добавить в избранное</button>'),"fav"==t&&(n+='<button id="favourite" onclick="removeFavourite('+data.indexOf(e)+')">Удалить из избранного</button>'),n+=""}function mainLoadMore(){document.querySelector("#show-more-button").remove();for(let e of data.slice(mainPagesGenerates*mainPageLength,(mainPagesGenerates+1)*mainPageLength))mainTab.innerHTML+=generateBox(e,"main");(mainPagesGenerates+=1)*mainPageLength<data.length&&(mainTab.innerHTML+='<button id="show-more-button" onclick="mainLoadMore()">Показать ещё</button>')}function favourite(e){for(let t of document.querySelectorAll('#tab[data-index="0"] .paronym-box.grid'))t.dataset.index!=e||lsFavourite.includes(e)||(lsFavourite.push(e),console.log(e),localStorage.setItem("favourite",[...new Set(lsFavourite)].join(",")),console.log(lsFavourite),favTab.innerHTML+=generateBox(data[e],"fav"))}function removeFavourite(e){for(let t of document.querySelectorAll('#tab[data-index="2"] .paronym-box.grid'))if(t.dataset.index==e){t.remove();let a=lsFavourite.indexOf(e);lsFavourite=lsFavourite.splice(a+1,1),localStorage.setItem("favourite",lsFavourite.join(","))}}function loadTrainingTasks(){fetch("/data/train.json").then(e=>e.json()).then(e=>{trainingTasks=e,trainingTab.innerHTML='<div id="train-main"><div><p class="train-task"></p><div id="train-buttons"></div></div></div><div id="train-explain"><details><summary>Подробнее</summary><div id="train-explain-box"></div></details></div>',trainMain=document.querySelector("#train-main"),trainTask=document.querySelector(".train-task"),trainButtons=document.querySelector("#train-buttons"),trainExplain=document.querySelector("#train-explain"),trainExplainBox=document.querySelector("#train-explain-box")}).then(()=>{generateTraining()}).then(()=>{trainingLoaded=!0})}function generateTraining(){trainButtons.innerHTML="",currentTask=trainingTasks[Math.floor(Math.random()*trainingTasks.length)],console.log(`ID: ${currentTask.id}`),trainMain.classList.remove("checked"),trainExplain.style.display="none",trainTask.innerText=currentTask.text.replace("_","________");const e=JSON.parse(JSON.stringify(currentTask.vars)).sort(()=>.5-Math.random());for(let t of e)trainButtons.innerHTML+="<button onclick=\"trainingCheckAnswer('"+t+"')\">"+t+"</button>"}function trainingCheckAnswer(e){trainTask.innerHTML=trainTask.innerHTML.replace("________",'<span style="color: var(--active-color)">'+currentTask.vars[0]+"</span>"),currentTask.id&&(trainExplainBox.innerHTML=generateBox(data[currentTask.id],"main"),trainMain.classList.add("checked"),trainExplain.style.display=""),e==currentTask.vars[0]?trainButtons.innerHTML='<button onclick="generateTraining()">Продолжить</button><p style="color: green;">Верно!</p>':trainButtons.innerHTML='<button onclick="generateTraining()">Продолжить</button><p style="color: red;">Неверно!</p>'}function saveSettings(){lsDaily[1]=settings_dailygoal_input.value,localStorage.setItem("dailygoal",lsDaily.join(","))}function clearData(){localStorage.setItem("favourite","-1"),localStorage.setItem("dailygoal","0,15"),favouriteLS()}fetch("/data/paronyms.json").then(e=>e.json()).then(e=>{data=e}).then(()=>{favouriteLS()}).then(()=>{for(let e of data.slice(0,mainPageLength)){let t=[];lsFavourite.includes(data.indexOf(e).toString())&&t.push("fav"),mainTab.innerHTML+=generateBox(e,"main",t)}mainTab.innerHTML+='<button id="show-more-button" onclick="mainLoadMore()">Показать ещё</button>'}).then(()=>{generateFavouriteTab()});